[
 {
  "allow_guest": 0,
  "api_method": "timesheet_1",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-10-06 14:45:50.594701",
  "module": "Law Firm",
  "name": "Timesheet Grouped by Lawyers",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "# Assuming you have a URL like this:\n# http://144.217.4.120:8002/api/method/timesheet_1/ACC-SINV-2024-000009\n\n# Access the sales invoice name from the URL\n# sales_invoice_name = inv_name  # or `frappe.form_dict.get('sales_invoice_name')` if it's named that\n\n# If you're using the default URL structure, you might need to access it as follows:\n# if len(frappe.form_dict) > 0:\n#     sales_invoice_name = list(frappe.form_dict.values())[0]  # Get the first value from form_dict\n\n# Now you can use sales_invoice_name in your SQL query\nfrappe.errprint(sales_invoice_name)\nquery = \"\"\"\n    SELECT name1, SUM(time) AS total_time, rate * SUM(time) AS total_amount, rate \n    FROM `tabSales Invoice LF Timesheet` \n    WHERE parent = %s \n    GROUP BY name1\n\"\"\"\n# Execute the query\nsummed_timesheet = frappe.db.sql(query, (sales_invoice_name,), as_dict=True)\ndoc.timesheet_data = summed_timesheet\n# Return the result in the response\nfrappe.errprint(summed_timesheet)\nfrappe.response['message'] = summed_timesheet\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Print",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-10-06 14:44:52.674851",
  "module": "Law Firm",
  "name": "fetch data before print",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice",
  "script": "timesheet_data = frappe.call(\r\n    method=\"law_firm.timesheet_1\",  # The full path to your API method\r\n    args={\"sales_invoice_name\": \"ACC-SINV-2024-000009\"}\r\n)\r\ndoc.timesheet_data = timesheet_data\r\n",
  "script_type": "DocType Event"
 }
]